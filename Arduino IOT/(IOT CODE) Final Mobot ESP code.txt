/* 
  Sketch generated by the Arduino IoT Cloud Thing "MOBOT V1"
  https://create.arduino.cc/cloud/things/dbca072b-fc73-458b-bfe4-5909d8e8f040 

  Arduino IoT Cloud Variables description

  The following variables are automatically generated and updated when changes are made to the Thing

  bool manualreverse;
  bool pump;
  bool manualleft;
  bool mobotswitch;
  bool manualstraight;
  bool linefollowermode;
  bool manualright;

  Variables which are marked as READ/WRITE in the Cloud Thing will also have functions
  which are called when their values are changed from the Dashboard.
  These functions are generated with the Thing and added at the end of this sketch.
*/

#include "thingProperties.h"

#define manualstraightpin 16    //D0
#define manualleftpin 5         //D1
#define manualrightpin 4        //D2
#define manualreversepin 0      //D3
#define espledpin 2             //D4
#define modepin 14              //D5       
#define pumppin 12              //D6
#define Standbypin 13           //D7
void setup() 
{
  // Initialize serial and wait for port to open:
  Serial.begin(9600);
  pinMode(manualstraightpin, OUTPUT);       
  pinMode(manualleftpin, OUTPUT);
  pinMode(manualrightpin, OUTPUT);
  pinMode(manualreversepin, OUTPUT);
  pinMode(modepin, OUTPUT);
  pinMode(pumppin, OUTPUT);
  pinMode(espledpin, OUTPUT);
  digitalWrite(espledpin,LOW);
  // This delay gives the chance to wait for a Serial Monitor without blocking if none is found
  delay(1500); 
  
  // Defined in thingProperties.h
  initProperties();

  // Connect to Arduino IoT Cloud
  ArduinoCloud.begin(ArduinoIoTPreferredConnection);
  
  /*
     The following function allows you to obtain more information
     related to the state of network and IoT Cloud connection and errors
     the higher number the more granular information youâ€™ll get.
     The default is 0 (only errors).
     Maximum is 4
 */
  setDebugMessageLevel(2);
  ArduinoCloud.printDebugInfo();
}

void loop() 
{
  ArduinoCloud.update();
  // Your code here 

  if(mobotswitch==LOW)                                      //main mobot switch off
  {
    digitalWrite(espledpin,HIGH);
    digitalWrite(pumppin,HIGH);
  }
  else if (mobotswitch==HIGH)
  {
    digitalWrite(espledpin,LOW);
    if (pump==HIGH)                                             //pump turned on
    {
      digitalWrite(pumppin,LOW);
    }
    else if (pump==LOW)                                         //pump turned off
    {
      digitalWrite(pumppin,HIGH);
    }
    if (linefollowermode==HIGH)                                 //main mobot switch on||line follower mode
    {
      digitalWrite(modepin,HIGH);
    }
    else if (linefollowermode==LOW)                             //main mobot switch on||manual mode
    {
      digitalWrite(modepin,LOW);
      if (manualstraight==HIGH)                                 //forward
      {
        digitalWrite(manualstraightpin,HIGH);
      }
      else if (manualstraight==LOW)
      {
        digitalWrite(manualstraightpin,LOW);
      }
      if (manualleft==HIGH)                                     //turn left
      {
        digitalWrite(manualleftpin,HIGH);
      }
      else if (manualleft==LOW)
      {
        digitalWrite(manualleftpin,LOW);
      }
      if (manualright==HIGH)                                    //turn right
      {
        digitalWrite(manualrightpin,HIGH);
      }
      else if (manualright==LOW)
      {
        digitalWrite(manualrightpin,LOW);
      }
      if (manualreverse==HIGH)                                  //reverse
      {
        digitalWrite(manualreversepin,HIGH);
      }
      else if (manualreverse==LOW)
      {
        digitalWrite(manualreversepin,LOW);
      }
    }
  }
}


/*
  Since Manualstraight is READ_WRITE variable, onManualstraightChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onManualstraightChange()  
{
  // Add your code here to act upon Manualstraight change
}
/*
  Since Manualleft is READ_WRITE variable, onManualleftChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onManualleftChange()  
{
  // Add your code here to act upon Manualleft change
}
/*
  Since Mobotswitch is READ_WRITE variable, onMobotswitchChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onMobotswitchChange()  
{

} 
/*
  Since Manualright is READ_WRITE variable, onManualrightChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onManualrightChange()  
{
  // Add your code here to act upon Manualright change
}
/*
  Since Linefollowermode is READ_WRITE variable, onLinefollowermodeChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onLinefollowermodeChange()  
{
  // Add your code here to act upon Linefollowermode change
}

/*
  Since Manualreverse is READ_WRITE variable, onManualreverseChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onManualreverseChange()  {
  // Add your code here to act upon Manualreverse change
}

/*
  Since Pump is READ_WRITE variable, onPumpChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onPumpChange()  {
  // Add your code here to act upon Pump change
}
